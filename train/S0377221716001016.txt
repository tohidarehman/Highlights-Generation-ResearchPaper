 The blocks relocation problem is a classic combinatorial optimisation problem that occurs in daily operations for facilities that use block stacking systems. In the block stacking method, blocks can be stored on top of each other in order to utilise the limited surface of a storage area. When there is a predetermined pickup order among the blocks, this stacking method inevitably leads to the reshuffling moves for blocks stored above the target block and the minimisation of such unproductive reshuffling moves is of a primary concern to industry practitioners. A container terminal is a typical place where this problem arises, thus the problem being also referred to as the container relocation problem. In this study, we consider departure time windows for containers, which are usually revealed by the truck appointment system in port container terminals. We propose a stochastic dynamic programming model to calculate the minimum expected number of reshuffles for a stack of containers which all have departure time windows. The model is solved with a search-based algorithm in a tree search space, and an abstraction heuristic is proposed to improve the time performance. To overcome the computational limitation of exact methods, we develop a heuristic called the expected reshuffling index (ERI) and evaluate its performance.

@highlight We combine the container relocation problem with the truck appointment system.
@highlight We model the container relocation problem with time windows for container departure.
@highlight We develop the abstraction heuristic, which improves the tree search by node caching.
@highlight We develop an index-based heuristic that outperforms the random selection heuristic.
@highlight The heuristic provides near-optimal solutions in a short time for large instances.
