 Energy efficiency of train operations is influenced largely by the speed control and the scheduled running time in the train timetable . In practice the running time of a train is often determined in the train timetabling process at the macroscopic level while the energy efficient speed control of a train on a segment is often determined at the microscopic level with the given timetable . They are usually optimized separately due to limited computational resources which however may result in sub optimal solutions . To address this issue this paper proposes a novel integrated micro macro approach for better incorporating train energy efficient speed control into the railway timetabling process . Firstly we formulated the integrated train timetabling and speed control optimization problem as a nonlinear mixed integer programming model . Due to its complexity we reformulate it on the basis of flow conservation theory in a spacetime speed network and solve the problem in two steps . In the first step a set of pre solved energy efficient train trajectory templates is generated by a segment level optimization approach with consideration of train travel time entry speed and exit speed to save computation time . In the second step a near optimum train energy efficient timetable solution is found by a fast algorithm which consists of the shortest generalized cost path algorithm conflict detection and resolution algorithm and calculation of dynamic headways between two successive trains . The numerical experiments demonstrate that the developed approach provides better outcomes than the benchmark case in terms of both train journey time and energy consumption .

@highlight Integrate train trajectory optimization with timetabling.
@highlight Pre solved segment level train trajectory is to improve computational efficiency.
@highlight Consider dynamic headways between two successive trains.
@highlight A fast algorithm is proposed to find the near optimum solution.
