 This paper presents a methodology based on auction theory to form a virtual power plant coalition of heterogeneous distributed energy resources . Moreover in this procedure the competition between VPPs for attracting DERs is considered . In this model the VPP has the ability to participate in the day ahead energy market become involved in the future energy market and sign bilateral contracts in a medium or long term time horizon . Also the ability of arbitrage between different markets is considered for the VPP . Moreover the risk of energy trading is taken into account with the risk measure method conditional value at risk . Due to the uncertain nature of pool prices a stochastic programming approach consist of two stages is developed for modeling the decision making problem . In the first stage the VPP participates in an auction and signs the renting capacity contracts with DERs based on auction results . The future market contracts are signed in this stage as well . In the next stage the decisions regarding bilateral contracts pool participation and DERs planning will be made . Also the uncertainty of the quantity and the price of bilateral contracts are considered . The efficiency of the model is analyzed in a few case studies .

@highlight Presenting a VPP coalition forming model based on auction.
@highlight Taking into account the competition between VPPs in the auction for attracting DERs.
@highlight Considering most uncertainties and risk of energy trading via a two stage stochastic model.
@highlight This model increases competition between DERs to increase their quality and decrease price.
@highlight The presented model can be used for medium and long term time horizons.
